language: generic

dist: trusty
sudo: required

env:
  global:
    # XXX: see details, etc/NEWS.24
    - NO_BIN_LINK=t
  matrix:
    - EMACS=emacs-24.5
    - EMACS=emacs-25.3
    - EMACS=emacs-26.2

matrix:
  allow_failures:
    - env: EMACS=emacs-24.5

before_install:
  # XXX: see details, etc/PROBLEMS [*** Segfault during 'make']
  - sudo sysctl kernel.randomize_va_space
  - sudo sysctl -w kernel.randomize_va_space=0

  - make -C .ci/recipe -f emacs.mk EMACS=${EMACS} PREFIX=${HOME}/.local/${EMACS}
  - export PATH=${HOME}/.local/${EMACS}/bin:${PATH}
  - ${EMACS} --version

install:
  - curl -fsSkL https://raw.github.com/cask/cask/master/go | python
  - export PATH=${PATH}:${HOME}/.cask/bin
  - cask install

script:
  - make compile
  - make test
